<!doctype html><html lang=en><head><title>Deleting empty folders in Outlook :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="A friend of mine called me, and asked me for help&amp;hellip; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&amp;rsquo;s of emtpy folders. He had started cleaning up the .pst&amp;rsquo;s manually, after having spent several hours on one .pst file he decided on another approach, and this is where I came in.
He asked if it was possible to write a script that would delete all the empty folders for him, I said to him that I bet it is possible, just not sure if I can do it, I have never really &amp;ldquo;scripted&amp;rdquo; Outlook before."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2009-03-30-deleting-empty-folders-in-outlook/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Deleting empty folders in Outlook :: XenoBlog"><meta property="og:description" content="A friend of mine called me, and asked me for help&amp;hellip; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&amp;rsquo;s of emtpy folders. He had started cleaning up the .pst&amp;rsquo;s manually, after having spent several hours on one .pst file he decided on another approach, and this is where I came in.
He asked if it was possible to write a script that would delete all the empty folders for him, I said to him that I bet it is possible, just not sure if I can do it, I have never really &amp;ldquo;scripted&amp;rdquo; Outlook before."><meta property="og:url" content="/posts/2009-03-30-deleting-empty-folders-in-outlook/"><meta property="og:site_name" content="Deleting empty folders in Outlook"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2009-03-30 16:17:26 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://github.com/claustn>github</a></li><li><a href=/about>RSS</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://github.com/claustn>github</a></li><li><a href=/about>RSS</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2009-03-30-deleting-empty-folders-in-outlook/>Deleting empty folders in Outlook</a></h1><div class=post-meta><span class=post-date>2009-03-30</span></div><span class=post-tags>#<a href=/tags/exchange/>Exchange</a>&nbsp;
#<a href=/tags/folder/>Folder</a>&nbsp;
#<a href=/tags/mail/>Mail</a>&nbsp;
#<a href=/tags/outlook/>Outlook</a>&nbsp;
#<a href=/tags/powershell/>PowerShell</a>&nbsp;</span><div class=post-content><div><p>A friend of mine called me, and asked me for help&mldr; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&rsquo;s of emtpy folders. He had started cleaning up the .pst&rsquo;s manually, after having spent several hours on one .pst file he decided on another approach, and this is where I came in.</p><p>He asked if it was possible to write a script that would delete all the empty folders for him, I said to him that I bet it is possible, just not sure if I can do it, I have never really &ldquo;scripted&rdquo; Outlook before..</p><p>So I started looking for ways to manipulate data in Outlook and found out that the Outlook.Application COM object allowed me to manipulate folders and messages within Outlook.. Did some quick testing, told my friend that it should be possible, and that I would get back to him&mldr;</p><p>After some mucking around here is what I ended up with.<br>[ps]<br>$olApp = new-object -com Outlook.Application<br>$namespace = $olApp.GetNamespace(&ldquo;MAPI&rdquo;)<br>#Root folder to match, look in your outlook and look at what folders you have.<br>#RooFolders could be Mailbox - &lt;username>, Public folders, or other mapped in PST&rsquo;s or mailboxes.<br>$RootfolderToMatch = &ldquo;Inbox&rdquo;</p><p>$Global:StopValue = 1</p><p>Function ListEmpty {<br>Param ($infolder)<br>Foreach ($fldr in $infolder.Folders) {</p><p>If ($fldr.Items.Count -eq 0 -and $fldr.Folders.Count -eq 0) {</p><h1 id=i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it>I have had to check for system folders, these cannot be deleted via the script, so to prevent the script for erroring out, I check for it.<a href=#i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it class=hanchor arialabel=Anchor>&#8983;</a></h1><p>if ($fldr.name -match &ldquo;Slettet&rdquo; -or $fldr.name -match &ldquo;Deleted&rdquo; -or $fldr.name -match &ldquo;journal&rdquo; -or $fldr.name -match &ldquo;rss"<code>-or $fldr.name -match "note" -or $fldr.name -match "kalender" -or $fldr.name -match "kontakt" -or $fldr.name -match "udbakke"</code><br>-or $fldr.name -match &ldquo;Sync&rdquo; -or $fldr.name -match &ldquo;Server&rdquo; -or $fldr.name -match &ldquo;contacts&rdquo; -or $fldr.name -match &ldquo;Outbox&rdquo; )<br>{&ldquo;Cannot delete systemfolder : "&rdquo;&rdquo; + $fldr.FolderPath + "&rdquo;</p><p>}</p><p>Else {<br>if ($fldr.Parent.name -notmatch &ldquo;slettet&rdquo; -and $fldr.Parent.name -notmatch &ldquo;Deleted&rdquo; ) {<br>#Remove # from the below line, to actually delete Outlook folders.<br>#$fldr.delete()<br>$fldr.FolderPath + " has been deleted!!&rdquo;</p><p>$Global:StopValue = 0<br>}<br>}<br>}</p><p>Else {<br>if ($fldr.name.length -gt 0) {</p><p>ListEmpty($fldr)}<br>}</p><p>}</p><p>}</p><p>$RootFolders = $namespace.Folders | ?{$_.name -match $RootfolderToMatch}</p><p>Listempty($RootFolders)</p><p>While ($Global:StopValue -eq 0) {<br>$Global:StopValue = 1<br>Listempty($RootFolders)<br>}</p><p>[/ps]</p><p>I start by initializing the Outlook COM object, and declaring some variables<br>[ps]<br>$olApp = new-object -com Outlook.Application<br>$namespace = $olApp.GetNamespace(&ldquo;MAPI&rdquo;)<br>#Root folder to match, look in your outlook and look at what folders you have.<br>#RooFolders could be Mailbox - &lt;/username>&lt;username>, Public folders, or other mapped in PST&rsquo;s or mailboxes.<br>$RootfolderToMatch = &ldquo;Inbox&rdquo;</p><p>$Global:StopValue = 1<br>[/ps]</p><p>I then create a function that takes an Outlook folder as a parameter.<br>I then loop through each subfolder, and checks to see if each folder contains any files or other folders, if it finds a folder that does not contain any files/folders it then checks to see if the folder name is something like &ldquo;outbox, sent items, Journal etc etc.&rdquo; The reason I do this is because these are system folders, and cannot be deleted, so if the script tried to delete one of them, it would come back with an error.</p><p>So if the folder that is currently being checked is empty and is not a system folder it will be deleted.(Actually the line where the folder is deleted is commented out, just to make sure there is not accidental deletions) The script then recurses through all subfolders to check for empty folders.</p><p>[ps]</p><p>Function ListEmpty {<br>Param ($infolder)<br>Foreach ($fldr in $infolder.Folders) {</p><p>If ($fldr.Items.Count -eq 0 -and $fldr.Folders.Count -eq 0) {</p><h1 id=i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it-1>I have had to check for system folders, these cannot be deleted via the script, so to prevent the script for erroring out, I check for it.<a href=#i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it-1 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>if ($fldr.name -match &ldquo;Slettet&rdquo; -or $fldr.name -match &ldquo;Deleted&rdquo; -or $fldr.name -match &ldquo;journal&rdquo; -or $fldr.name -match &ldquo;rss"<code>-or $fldr.name -match "note" -or $fldr.name -match "kalender" -or $fldr.name -match "kontakt" -or $fldr.name -match "udbakke"</code><br>-or $fldr.name -match &ldquo;Sync&rdquo; -or $fldr.name -match &ldquo;Server&rdquo; -or $fldr.name -match &ldquo;contacts&rdquo; -or $fldr.name -match &ldquo;Outbox&rdquo; )<br>{&ldquo;Cannot delete systemfolder : "&rdquo;&rdquo; + $fldr.FolderPath + "&rdquo;</p><p>}</p><p>Else {<br>if ($fldr.Parent.name -notmatch &ldquo;slettet&rdquo; -and $fldr.Parent.name -notmatch &ldquo;Deleted&rdquo; ) {<br>#Remove # from the below line, to actually delete Outlook folders.<br>#$fldr.delete()<br>$fldr.FolderPath + " has been deleted!!&rdquo;</p><p>$Global:StopValue = 0<br>}<br>}<br>}</p><p>Else {<br>if ($fldr.name.length -gt 0) {</p><p>ListEmpty($fldr)}<br>}</p><p>}</p><p>}</p><p>[/PS]</p><p>Rootfolders is the initial &ldquo;path&rdquo;/folder that the scripts starts to look for empty folders from.<br>$namespace.folders is the highest folder level in Outlook, it contains the user mailbox, public folders and any mapped in .pst files, so what I do here is match a single top level folder.</p><p>Here is an example, lets say I have opened a .pst file called BusinessCases09, I would set $RootfolderToMatch equal to &lt;em>BusinessCases09&lt;/em> (This is set at the beginning of the script), that means when the ListEmpty function is called for the first time, it will scan through all subfolders of the .pst file.<br>[ps]</p><p>$RootFolders = $namespace.Folders | ?{$_.name -match $RootfolderToMatch}</p><p>Listempty($RootFolders)</p><p>[/ps]</p><p>In order to make sure the script runs to all empty folders is deleted, I have set up a while loop to call function until no more empty folders are found.<br>[ps]<br>While ($Global:StopValue -eq 0) {<br>$Global:StopValue = 1<br>Listempty($RootFolders)<br>[/ps]</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2009-04-17-arrived-safely-in-washington-dulles-airport/><span class=button__icon>←</span>
<span class=button__text>Arrived safely in Washington Dulles airport</span></a></span>
<span class="button next"><a href=/posts/2009-03-11-get-mailboxinfo-powershell-script/><span class=button__text>Get-Mailboxinfo Powershell script</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>