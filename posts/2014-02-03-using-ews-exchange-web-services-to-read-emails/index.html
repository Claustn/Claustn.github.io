<!doctype html><html lang=en><head><title>Using EWS (Exchange Web Services) to read email subjects. :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Today I had a discussion with a vendor, they are delivering a solution that reads email from a specific email account on Exchange, and create a ticket in our helpdesk system. Often the email subjects shows up mangled in the helpdesk system, and the particular vendor blames Exchange EWS for not messing up the data.. I had a hard time believing that, so I set out to prove it is not Exchange that is a fault."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2014-02-03-using-ews-exchange-web-services-to-read-emails/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Using EWS (Exchange Web Services) to read email subjects. :: XenoBlog"><meta property="og:description" content="Today I had a discussion with a vendor, they are delivering a solution that reads email from a specific email account on Exchange, and create a ticket in our helpdesk system. Often the email subjects shows up mangled in the helpdesk system, and the particular vendor blames Exchange EWS for not messing up the data.. I had a hard time believing that, so I set out to prove it is not Exchange that is a fault."><meta property="og:url" content="/posts/2014-02-03-using-ews-exchange-web-services-to-read-emails/"><meta property="og:site_name" content="Using EWS (Exchange Web Services) to read email subjects."><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2014-02-03 21:27:21 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://github.com/claustn>github</a></li><li><a href=/about>RSS</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://github.com/claustn>github</a></li><li><a href=/about>RSS</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2014-02-03-using-ews-exchange-web-services-to-read-emails/>Using EWS (Exchange Web Services) to read email subjects.</a></h1><div class=post-meta><span class=post-date>2014-02-03</span></div><div class=post-content><div><p>Today I had a discussion with a vendor, they are delivering a solution that reads email from a specific email account on Exchange, and create a ticket in our helpdesk system. Often the email subjects shows up mangled in the helpdesk system, and the particular vendor blames Exchange EWS for not messing up the data.. I had a hard time believing that, so I set out to prove it is not Exchange that is a fault.</p><p>First off I needed to download Exchange EWS, which is a separate download from Microsoft.</p><p>So just download and install the MSI file.</p><p>Then it is time to fire up PowerShell, first thing we need to do is load the EWS assembly</p><pre><code>Add-Type -Path &quot;C:\Program Files\Microsoft\Exchange\Web Services\1.2\Microsoft.Exchange.WebServices.dll&quot;
</code></pre><p>Then we need to specify a username, Password, domain and the mailbox that we want to look at. There are several ways to do this, the simplest way is just writing this in clear text.</p><pre><code>$Username = &quot;PeterJ&quot; $Password = &quot;PetersSecurePassword&quot; $Domain = &quot;PetersDomain&quot; $Email = &quot;PeterJ@PetersDomain.com&quot;
</code></pre><p>Or you could query for it:</p><pre><code>$cred = (Get-Credential).GetNetworkCredential()
</code></pre><p>Then we have to create a EWS Exchange object.</p><pre><code>$EWS = New-Object Microsoft.Exchange.WebServices.Data.ExchangeService -ArgumentList &quot;Exchange2010\_SP1&quot;
</code></pre><p>Possible options for ExchangeService types are Exchange2007_SP1, Exchange2010, Exchange2010_SP1 or Exchange2010_SP2.</p><p>Then we have to pass credentials to the $EWS objects depending on how we chose to supply the password initially, we have 2 options again.</p><p>Here is the way if we supplied the information in clear text</p><pre><code>$EWS.Credentials = New-Object System.Net.NetworkCredential -ArgumentList $Username, $Password, $Domain
</code></pre><p>Here is the way if we prompt for the username/password with Get-Credential</p><pre><code>$EWS.Credentials = New-Object System.Net.NetworkCredential -ArgumentList $cred.UserName, $cred.Password, $cred.Domain
</code></pre><p>Then we use the AutoDiscoverURL method to look up the Exchange Server URL endpoint.</p><pre><code>$EWS.AutodiscoverUrl($Email)
</code></pre><p>In this example we will iterate through the inbox and list the first 20 items and output the subjects.</p><pre><code>$results = $EWS.FindItems(&quot;Inbox&quot;,( New-Object Microsoft.Exchange.WebServices.Data.ItemView -ArgumentList 20 )) $results.Items | ForEach-Object { $\_.Subject }
</code></pre><p>Here is the script in its entirety.</p><pre><code>Add-Type -Path &quot;C:\Program Files\Microsoft\Exchange\Web Services\1.2\Microsoft.Exchange.WebServices.dll&quot; $Email = &quot;ctn@appension.dk&quot; $EWS = New-Object Microsoft.Exchange.WebServices.Data.ExchangeService -ArgumentList &quot;Exchange20101\_SP1&quot; $cred = (Get-Credential).GetNetworkCredential() $EWS.Credentials = New-Object System.Net.NetworkCredential -ArgumentList $cred.UserName, $cred.Password, $cred.Domain #Use Autodiscover to find the right URL endpoint $EWS.AutodiscoverUrl($Email) #Search the inbox $results = $EWS.FindItems(&quot;Inbox&quot;,( New-Object Microsoft.Exchange.WebServices.Data.ItemView -ArgumentList 20 )) $results.Items | ForEach-Object { $\_.Subject }
</code></pre><p>After analyzing the output from Exchange many times, I am convinced that the vendor is mistaken when he claims Exchange is screwing up the data.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2014-02-22-updating-upn-names-in-active-directory/><span class=button__icon>←</span>
<span class=button__text>Updating UPN names in Active Directory</span></a></span>
<span class="button next"><a href=/posts/2014-01-08-readable-password-generator/><span class=button__text>Readable Password generator</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>