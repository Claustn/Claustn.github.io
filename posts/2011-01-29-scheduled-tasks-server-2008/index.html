<!doctype html><html lang=en><head><title>Scheduled Tasks Server 2008(R2) :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="I have been working on a script for changing passwords on scheduled tasks in our domain, in that process I have run into a few kinks with scheduled tasks in server 2008(R2).
I tried different ways of manipulating the scheduled tasks, but ended up using schtasks.exe from the commandline, so I wrote some Powershell code to wrap around the schtasks.exe to connect to multiple machines.. But I kept getting errors on some servers, so I decided to dig into the issue."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2011-01-29-scheduled-tasks-server-2008/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Scheduled Tasks Server 2008(R2) :: XenoBlog"><meta property="og:description" content="I have been working on a script for changing passwords on scheduled tasks in our domain, in that process I have run into a few kinks with scheduled tasks in server 2008(R2).
I tried different ways of manipulating the scheduled tasks, but ended up using schtasks.exe from the commandline, so I wrote some Powershell code to wrap around the schtasks.exe to connect to multiple machines.. But I kept getting errors on some servers, so I decided to dig into the issue."><meta property="og:url" content="/posts/2011-01-29-scheduled-tasks-server-2008/"><meta property="og:site_name" content="Scheduled Tasks Server 2008(R2)"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2011-01-29 22:12:17 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2011-01-29-scheduled-tasks-server-2008/>Scheduled Tasks Server 2008(R2)</a></h1><div class=post-meta><span class=post-date>2011-01-29</span></div><div class=post-content><div><p>I have been working on a script for changing passwords on scheduled tasks in our domain, in that process I have run into a few kinks with scheduled tasks in server 2008(R2).</p><p>I tried different ways of manipulating the scheduled tasks, but ended up using schtasks.exe from the commandline, so I wrote some Powershell code to wrap around the schtasks.exe to connect to multiple machines.. But I kept getting errors on some servers, so I decided to dig into the issue. After a lot of testing I figured out, that scheduled tasks created from the Task Scheduler GUI, could not be changed with schtasks.exe from the commandline.<br>So I had to dig a little deeper, and figure out what was happening, and how to work around it. The problem can be seen if you export the scheduled task into XML.</p><p>The first picture here is a scheduled task created from the command line.</p><p><a href=http://www.xipher.dk/WordPress/wp-content/uploads/image10.png><img src=/assets/images/image_thumb10.png alt=image title=image></a></p><p> </p><p>This one is from a scheduled task created from the Task scheduler GUI (Notice the date format contains 6 or 7 decimals)</p><p><a href=http://www.xipher.dk/WordPress/wp-content/uploads/image11.png><img src=/assets/images/image_thumb11.png alt=image title=image></a></p><p>Apparently schtasks.exe does not like the date/time format in a task created in the GUI, but if you export the scheduled task to XML change remove the “decimals” and reimport the scheduled task, you can now manage it from the command line with schtasks.exe (How was this not caught in testing ??)</p><p> </p><p>So to avoid going out to all 2008(R2) machines and do it manually, I wrote a small Powershell script to dump a scheduled task to XML and change the date/time and reimport it.</p><p>[ps]<br>Function Update-ScheduledTask {<br>param(<br>[Parameter(Position=1,Mandatory=$true)]<br>$SchedName ,<br>[Parameter(Position=2,Mandatory=$false)]<br>$ComputerName = &ldquo;Localhost&rdquo;<br>)</p><p>$ShortDate = [regex]"(?&lt;ShortDate>[0-9]{4}<a href=?:1%5B0-2%5D%7C0%5B1-9%5D>/.-</a><a href=?:3%5B01%5D%7C%5B12%5D%5B0-9%5D%7C0%5B1-9%5D>/.-</a>T(?:2[0-3]|[01][0-9])[:.][0-5][0-9][:.][0-5][0-9])(?&lt;Digits>.\d*)&rdquo;<br>Remove-Item &ldquo;$Env:TEMP$($SchedName).xml&rdquo;<br>$XMLIn = schtasks /query /s $Computername /tn $SchedName /xml</p><p>foreach ($line in $XMLIn){<br>If ($line -match &ldquo;$ShortDate&rdquo;) {<br>$line = [regex]::Replace($line, $ShortDate, $($Matches[&ldquo;Shortdate&rdquo;]))<br>}<br>If ($line.length -gt 1) {<br>$line | Out-File -Append -FilePath &ldquo;$Env:TEMP$($SchedName).xml&rdquo;}<br>}<br>schtasks /Create /tn $SchedName /XML &ldquo;$Env:TEMP$($SchedName).xml&rdquo; /f<br>}<br>[/ps]</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2011-01-29-change-usernamepassword-on-scheduled-tasks/><span class=button__icon>←</span>
<span class=button__text>Change username/password on scheduled tasks.</span></a></span>
<span class="button next"><a href=/posts/2011-01-14-free-online-source-control-with-powergui-pro/><span class=button__text>Free online Source Control with PowerGui Pro.</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>