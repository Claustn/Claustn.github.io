<!doctype html><html lang=en><head><title>Quest AD Cmdlet examples from my Presentation :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Example #1
List users that expires within X days
[ps]
$DaysToExpire = 14
$MaxPassAge = (Get-QADObject (Get-QADRootDSE).defaultNamingContextDN).MaximumPasswordAge.days
[array]$a = Get-QADUser -Enabled -PasswordNeverExpires:$false -SizeLimit 0 -Email * |Select-Object Name,Email,@{Name=&amp;quot;Expires&amp;rdquo;;Expression={ $MaxPassAge - $_.PasswordAge.days }} | where {$_.Expires -lt 0} | Sort-Object expires
[/ps]
Example #2
Locate that Hyper-V Host
[ps]
Get-QADComputer | Where {$_.OSname -match &amp;ldquo;2008&amp;rdquo;} | % { Get-Service -ComputerName $_.Name} | where {$_.Displayname -match &amp;ldquo;hyper&amp;rdquo;} | select Machinename, Displayname
#Kirk Munroe pointed out that Hyper-V actually registers ans SCP (Service Connection Point)"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2010-05-11-quest-ad-cmdlet-examples-from-my-presentation/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Quest AD Cmdlet examples from my Presentation :: XenoBlog"><meta property="og:description" content="Example #1
List users that expires within X days
[ps]
$DaysToExpire = 14
$MaxPassAge = (Get-QADObject (Get-QADRootDSE).defaultNamingContextDN).MaximumPasswordAge.days
[array]$a = Get-QADUser -Enabled -PasswordNeverExpires:$false -SizeLimit 0 -Email * |Select-Object Name,Email,@{Name=&amp;quot;Expires&amp;rdquo;;Expression={ $MaxPassAge - $_.PasswordAge.days }} | where {$_.Expires -lt 0} | Sort-Object expires
[/ps]
Example #2
Locate that Hyper-V Host
[ps]
Get-QADComputer | Where {$_.OSname -match &amp;ldquo;2008&amp;rdquo;} | % { Get-Service -ComputerName $_.Name} | where {$_.Displayname -match &amp;ldquo;hyper&amp;rdquo;} | select Machinename, Displayname
#Kirk Munroe pointed out that Hyper-V actually registers ans SCP (Service Connection Point)"><meta property="og:url" content="/posts/2010-05-11-quest-ad-cmdlet-examples-from-my-presentation/"><meta property="og:site_name" content="Quest AD Cmdlet examples from my Presentation"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2010-05-11 22:06:28 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2010-05-11-quest-ad-cmdlet-examples-from-my-presentation/>Quest AD Cmdlet examples from my Presentation</a></h1><div class=post-meta><span class=post-date>2010-05-11</span></div><span class=post-tags>#<a href=/tags/powershell/>PowerShell</a>&nbsp;</span><div class=post-content><div><p>Example #1<br>List users that expires within X days<br>[ps]<br>$DaysToExpire = 14<br>$MaxPassAge = (Get-QADObject (Get-QADRootDSE).defaultNamingContextDN).MaximumPasswordAge.days<br>[array]$a = Get-QADUser -Enabled -PasswordNeverExpires:$false -SizeLimit 0 -Email * |Select-Object Name,Email,@{Name="Expires&rdquo;;Expression={ $MaxPassAge - $_.PasswordAge.days }} | where {$_.Expires -lt 0} | Sort-Object expires<br>[/ps]</p><p>Example #2<br>Locate that Hyper-V Host<br>[ps]<br>Get-QADComputer | Where {$_.OSname -match &ldquo;2008&rdquo;} | % { Get-Service -ComputerName $_.Name} | where {$_.Displayname -match &ldquo;hyper&rdquo;} | select Machinename, Displayname</p><p>#Kirk Munroe pointed out that Hyper-V actually registers ans SCP (Service Connection Point)<br>Get-QADObject -Name &lsquo;Microsoft Hyper-V&rsquo; -Type serviceConnectionPoint | Get-QADComputer -Identity {$_.ParentContainerDN}<br>[/ps]</p><p>Example #3<br>Create test users and OU&rsquo;s in AD<br>[ps]<br>#Gets the default naming context<br>$RootDN = (Get-QADRootDSE).DefaultNamingContextDN<br>#Name of OU going to be created in the root of &ldquo;AD&rdquo;<br>$RootOUName = &ldquo;MinasiTest&rdquo;<br>#Create &ldquo;root&rdquo; OU<br>new-qadObject -ParentContainer $RootDN -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name $RootOUName<br>#Create sub OU&rsquo;s, create as many as you like, you only need to change the -name property in the end of the line<br>new-qadObject -ParentContainer &ldquo;OU=$RootOUName,$RootDN&rdquo; -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name &lsquo;Administrators&rsquo;<br>new-qadObject -ParentContainer &ldquo;OU=$RootOUName,$RootDN&rdquo; -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name &lsquo;Marketing&rsquo;<br>new-qadObject -ParentContainer &ldquo;OU=$RootOUName,$RootDN&rdquo; -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name &lsquo;Sales&rsquo;<br>new-qadObject -ParentContainer &ldquo;OU=$RootOUName,$RootDN&rdquo; -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name &lsquo;IT&rsquo;<br>new-qadObject -ParentContainer &ldquo;OU=$RootOUName,$RootDN&rdquo; -type &lsquo;organizationalUnit&rsquo; -NamingProperty &lsquo;ou&rsquo; -name &lsquo;HR&rsquo;</p><h1 id=heading><a href=#heading class=hanchor arialabel=Anchor>&#8983;</a></h1><h1 id=heading-1><a href=#heading-1 class=hanchor arialabel=Anchor>&#8983;</a></h1><h1 id=heading-2><a href=#heading-2 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>#Enter the DN path of the OU you want to add users to<br>#Note I manually put in the DN of an OU in my test environment, you will have to put one in that exists in your environment</p><p>#$OuPath = &lsquo;OU=Aprismo Users,DC=aprismo,DC=test&rsquo;<br>$OuPath = &ldquo;OU=$RootOUName,$RootDN&rdquo;</p><p>#Number of users to create in each OU</p><p>$No = 5</p><p>Function AddUsers<br>{<br>param([string]$OUDN, [string]$OUName)</p><p>foreach($user in 1..$No)<br>{<br>$UserName = &ldquo;Test$OUName$User&rdquo;<br>$UserPassword = &ldquo;P@ssw0rd123!&rdquo;<br>$ExpiresOn = $((Get-Date).AddMonths(1))<br>$userDescription = &ldquo;User added for Performance Testing on $(Get-date) and Expires on $ExpiresOn&rdquo;</p><p>$user = New-QADUser -name $UserName <code>-SamAccountName $UserName</code><br>-Description $UserDescription <code>-ParentContainer $OUDN</code><br>-UserPassword $UserPassword</p><p>$user | Set-QADUser -AccountExpires ((Get-Date).AddMonths(1))<br>}<br>}</p><p>#This foreach loops through all OU&rsquo;s &ldquo;below&rdquo; $OUPath<br>Foreach ($OU in Get-QADObject -SearchRoot $OUPath -Type &lsquo;organizationalUnit&rsquo;){<br>Addusers $OU.DN $OU.Name<br>}</p><p>[/pa]</p><p>Example #4<br>Rename Groups in AD<br>[ps]<br>Get-QADGroup -Name &ldquo;xyz*&rdquo; | %{Set-QADGroup -Identity $_ -SamAccountName ($_.Name).Replace(&ldquo;xyz&rdquo;,&ldquo;abc&rdquo;) -whatif ;Rename-QADObject -Identity $_ -NewName ($_.Name).Replace(&ldquo;xyz&rdquo;,&ldquo;abc&rdquo;) -WhatIf }<br>[/ps]</p><p>Example #5<br>Output a list of servers in a Excel documents, with ping stats and if the machine is disabled/enabled<br>[ps][/ps]<br>#$serverlist = Get-QADComputer -LdapFilter &lsquo;(!(userAccountControl:1.2.840.113556.1.4.803:=2))&rsquo; | where {$_.Osname -like &ldquo;*server*"}<br>$serverlist = Get-QADComputer -IncludedProperties pwdLastSet -SizeLimit 0 | where {$_.Osname -like &ldquo;*server*"}</p><p>$erroractionpreference = &ldquo;SilentlyContinue&rdquo;<br>$a = New-Object -comobject Excel.Application<br>$a.visible = $True</p><p>$b = $a.Workbooks.Add()<br>$c = $b.Worksheets.Item(1)</p><p>$c.Cells.Item(1,1) = &ldquo;Machine Name&rdquo;<br>$c.Cells.Item(1,2) = &ldquo;OS Name&rdquo;<br>$c.Cells.Item(1,3) = &ldquo;IP Address&rdquo;<br>$c.Cells.Item(1,4) = &ldquo;Ping Status&rdquo;<br>$c.Cells.Item(1,5) = &ldquo;Password last set&rdquo;<br>$c.Cells.Item(1,6) = &ldquo;Enabled/Disabled&rdquo;<br>$c.Cells.Item(1,7) = &ldquo;Physical/Virtual&rdquo;</p><p>$d = $c.UsedRange<br>$d.Interior.ColorIndex = 19<br>$d.Font.ColorIndex = 11<br>$d.Font.Bold = $True</p><p>$intRow = 2</p><p>$colComputers = $serverlist<br>foreach ($strComputer in $colComputers)<br>{<br>$c.Cells.Item($intRow, 1) = $strComputer.Name</p><p>$ping = new-object System.Net.NetworkInformation.Ping<br>$Reply = $ping.send($strComputer.Name)</p><p>if ($Reply.status –eq “Success”)<br>{<br>$machineType = Get-WmiObject -ComputerName $strComputer.Name -Class Win32_BIOS</p><p>If ($strComputer.AccountIsDisabled) {$enab = &ldquo;Disabled&rdquo;} else {$enab = &ldquo;Enabled&rdquo;}<br>if ($strComputer.pwdLastSet -le (Get-Date).AddDays(-90)) {$age = &ldquo;Older than 90 Days&rdquo; ; $fgColor = 3} else {$age = &ldquo;Less than 90 days&rdquo;; $fgColor = 0}</p><p>if ($machineType.Serialnumber -like &ldquo;*vmware*") {$type = &ldquo;VMware&rdquo;}<br>Elseif ($machineType.Version -like &ldquo;*VRTUAL*") {$type = &ldquo;Hyper-V&rdquo;}<br>Elseif (!($machineType.Version)) {$type = &ldquo;N/A&rdquo;}<br>else {$type = &ldquo;Physical&rdquo;}</p><p>$c.Cells.Item($intRow, 2) = $strComputer.OSName<br>$c.Cells.Item($intRow, 3) = $Reply.Address.ToString()<br>$c.Cells.Item($intRow, 4) = &ldquo;Online&rdquo;<br>$c.Cells.item($intRow, 5).Interior.ColorIndex = $fgColor<br>$c.Cells.Item($intRow, 5) = $age<br>$c.Cells.Item($intRow, 6) = $enab<br>$c.Cells.Item($intRow, 7) = $type<br>$Reply = "&rdquo;<br>$intRow = $intRow + 1</p><p>}<br>else<br>{<br>$machineType = Get-WmiObject -ComputerName $strComputer.Name -Class Win32_BIOS</p><p>If ($strComputer.AccountIsDisabled) {$enab = &ldquo;Disabled&rdquo;} else {$enab = &ldquo;Enabled&rdquo;}<br>if ($strComputer.pwdLastSet -le (Get-Date).AddDays(-90)) {$age = &ldquo;Older than 90 Days&rdquo; ; $fgColor = 3} else {$age = &ldquo;Less than 90 days&rdquo;; $fgColor = 0}<br>if ($machineType.Serialnumber -like &ldquo;*vmware*") {$type = &ldquo;VMware&rdquo;}<br>Elseif (!($machineType.Version)) {$type = &ldquo;N/A&rdquo;}<br>Elseif ($machineType.Version -like &ldquo;*VRTUAL*") {$type = &ldquo;Hyper-V&rdquo;}<br>else {$type = &ldquo;Physical&rdquo;}</p><p>$c.Cells.Item($intRow, 2) = $strComputer.OSName<br>$c.Cells.Item($intRow, 3) = $Reply.Address.ToString()<br>$c.Cells.Item($intRow, 4) = &ldquo;Offline&rdquo;<br>$c.Cells.item($intRow, 5).Interior.ColorIndex = $fgColor<br>$c.Cells.Item($intRow, 5) = $age<br>$c.Cells.Item($intRow, 6) = $enab<br>$c.Cells.Item($intRow, 7) = $type<br>$Reply = "&rdquo;</p><p>$intRow = $intRow + 1</p><p>}<br>$d.EntireColumn.AutoFit()</p><p>}<br>[ps][/ps]</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2010-05-11-remoting-examples-from-my-presentation/><span class=button__icon>←</span>
<span class=button__text>Remoting examples from my presentation</span></a></span>
<span class="button next"><a href=/posts/2010-05-11-net-examples-from-presentation/><span class=button__text>.Net Examples from Presentation</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>