<!doctype html><html lang=en><head><title>Right click to mount vhd files :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="I have just upgraded my machines to Windows 7 RTM, before I did the reinstall I did full backup of my old Vista machines, of course I figured out that I had not gotten all the files out of the Vista machines before I upgraded, So I had to restore some files from the resulting .vhd backup images. But when I started Windows 7 restore, it did not recognize the backup folders."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2009-09-14-right-click-to-mount-vhd-files/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Right click to mount vhd files :: XenoBlog"><meta property="og:description" content="I have just upgraded my machines to Windows 7 RTM, before I did the reinstall I did full backup of my old Vista machines, of course I figured out that I had not gotten all the files out of the Vista machines before I upgraded, So I had to restore some files from the resulting .vhd backup images. But when I started Windows 7 restore, it did not recognize the backup folders."><meta property="og:url" content="/posts/2009-09-14-right-click-to-mount-vhd-files/"><meta property="og:site_name" content="Right click to mount vhd files"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Tech Stuff"><meta property="article:published_time" content="2009-09-14 13:41:54 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2009-09-14-right-click-to-mount-vhd-files/>Right click to mount vhd files</a></h1><div class=post-meta><span class=post-date>2009-09-14</span></div><span class=post-tags>#<a href=/tags/powershell/>PowerShell</a>&nbsp;
#<a href=/tags/vhd/>vhd</a>&nbsp;
#<a href=/tags/windows-7/>Windows 7</a>&nbsp;</span><div class=post-content><div><p>I have just upgraded my machines to Windows 7 RTM, before I did the reinstall I did full backup of my old Vista machines, of course I figured out that I had not gotten all the files out of the Vista machines before I upgraded, So I had to restore some files from the resulting .vhd backup images. But when I started Windows 7 restore, it did not recognize the backup folders.. So I thought I would just mount the vhd backup files manually, by going into Computer Management -> Disk management. But after having done that a few times, I thought it was too much hassle, so I decided to write a little PowerShell script to mount the vhd files for me.<br>[ps]</p><h1 id=powershell-function-to-create-a-script-file-for-diskpart>PowerShell function to create a script file for diskpart<a href=#powershell-function-to-create-a-script-file-for-diskpart class=hanchor arialabel=Anchor>&#8983;</a></h1><h1 id=and-the-execute-diskpart-with-the-scriptfile>and the execute diskpart with the scriptfile<a href=#and-the-execute-diskpart-with-the-scriptfile class=hanchor arialabel=Anchor>&#8983;</a></h1><p>function Mount-Vhd {param([String]$InputFile)<br>&ldquo;SELECT VDISK FILE="&ldquo;$InputFile&rdquo;&rdquo;&rdquo; + &ldquo;<code>r</code>n&rdquo; + &ldquo;ATTACH VDISK&rdquo; | Out-File $env:TEMP\Mountvhd.txt -Encoding &ldquo;ASCII&rdquo;<br>Invoke-Expression -Command &ldquo;Diskpart.exe /s $env:TEMP\Mountvhd.txt&rdquo;<br>}<br>Mount-Vhd $args[0]<br>[/ps]<br>The above script has to be saved as &ldquo;Mount-vhd.ps1&rdquo;</p><p>But I wanted something even more simple, I just wanted to be able to right-click a .vhd file and choose open, so I created this little .reg file, that will allow you to right click a .vhd file and choose open.</p><p>Windows Registry Editor Version 5.00</p><p>[HKEY_CLASSES_ROOT.vhd]</p><p>[HKEY_CLASSES_ROOT.vhd\shell]<br>@="Open VHD&rdquo;</p><p>[HKEY_CLASSES_ROOT.vhd\shell\Open VHD]<br>@="Open &VHD&rdquo;</p><p>[HKEY_CLASSES_ROOT.vhd\shell\Open VHD\command]<br>@=hex(2):22,00,43,00,3a,00,5c,00,57,00,69,00,6e,00,64,00,6f,00,77,00,73,00,5c,\<br>00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,57,00,69,00,6e,00,\<br>64,00,6f,00,77,00,73,00,50,00,6f,00,77,00,65,00,72,00,53,00,68,00,65,00,6c,\<br>00,6c,00,5c,00,76,00,31,00,2e,00,30,00,5c,00,70,00,6f,00,77,00,65,00,72,00,\<br>73,00,68,00,65,00,6c,00,6c,00,2e,00,65,00,78,00,65,00,22,00,20,00,2d,00,57,\<br>00,69,00,6e,00,64,00,6f,00,77,00,53,00,74,00,79,00,6c,00,65,00,20,00,68,00,\<br>69,00,64,00,64,00,65,00,6e,00,20,00,2d,00,66,00,69,00,6c,00,65,00,20,00,22,\<br>00,63,00,3a,00,5c,00,74,00,6f,00,6f,00,6c,00,73,00,5c,00,4d,00,6f,00,75,00,\<br>6e,00,74,00,2d,00,76,00,68,00,64,00,2e,00,70,00,73,00,31,00,22,00,20,00,22,\<br>00,25,00,31,00,22,00,00,00</p><p>When you import the file, all the hex values are converted back to ascii chars, which you can see under [HKEY_CLASSES_ROOT.vhd\shell\Open VHD\command] of course</p><p>Here is what will be written:</p><p>&ldquo;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&rdquo; -WindowStyle hidden -file &ldquo;c:\tools\Mount-vhd.ps1&rdquo; &ldquo;%1&rdquo;</p><p>As you can see it expects the Mount-Vhd powershell file to be located in C:\tools\ in order to work. I have so far not been able to make it work, without referencing the file directly.</p><p>But when you have imported the .reg file, you can just navigate to [HKEY_CLASSES_ROOT.vhd\shell\Open VHD\command] and change the path to anything you like.</p><p>You can download both files from here: <a href=http://xipher.dk/Tools/ImportVHDsettings.zip>http://xipher.dk/Tools/ImportVHDsettings.zip</a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2009-09-19-findind-that-hyper-v-machine/><span class=button__icon>←</span>
<span class=button__text>Finding that Hyper-V machine</span></a></span>
<span class="button next"><a href=/posts/2009-09-04-windows-7-rsat/><span class=button__text>Windows 7 & RSAT</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>