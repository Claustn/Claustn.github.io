<!doctype html><html lang=en><head><title>Troubleshooting Test-Connection :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="I was contacted by a friend who was having some issues with Test-Connection when using TimeToLive
Example:
Test-Connection -ComputerName www.google.ie -Count 1 -TimeToLive 3
Test-Connection : Testing connection to computer &amp;lsquo;www.google.ie&amp;rsquo; failed: Problem with some part of the filterspec or providerspecific buffer in general
At line:1 char:1
  Test-Connection -ComputerName www.google.ie -TimeToLive 3
      + CategoryInfo : ResourceUnavailable: (www.google.ie:String) [Test-Connection], PingException
 + FullyQualifiedErrorId : TestConnectionException,Microsoft."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2012-09-10-troubleshooting-test-connection/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Troubleshooting Test-Connection :: XenoBlog"><meta property="og:description" content="I was contacted by a friend who was having some issues with Test-Connection when using TimeToLive
Example:
Test-Connection -ComputerName www.google.ie -Count 1 -TimeToLive 3
Test-Connection : Testing connection to computer &amp;lsquo;www.google.ie&amp;rsquo; failed: Problem with some part of the filterspec or providerspecific buffer in general
At line:1 char:1
  Test-Connection -ComputerName www.google.ie -TimeToLive 3
      + CategoryInfo : ResourceUnavailable: (www.google.ie:String) [Test-Connection], PingException
 + FullyQualifiedErrorId : TestConnectionException,Microsoft."><meta property="og:url" content="/posts/2012-09-10-troubleshooting-test-connection/"><meta property="og:site_name" content="Troubleshooting Test-Connection"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2012-09-10 21:38:40 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://github.com/claustn>github</a></li><li><a href=/index.xml>RSS</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://github.com/claustn>github</a></li><li><a href=/index.xml>RSS</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2012-09-10-troubleshooting-test-connection/>Troubleshooting Test-Connection</a></h1><div class=post-meta><span class=post-date>2012-09-10</span></div><div class=post-content><div><p>I was contacted by a friend who was having some issues with Test-Connection  when using TimeToLive</p><p>Example:</p><p>Test-Connection -ComputerName <a href=http://www.google.ie/>www.google.ie</a> -Count 1 -TimeToLive 3</p><p>Test-Connection : Testing connection to computer &lsquo;<a href=http://www.google.ie/>www.google.ie</a>&rsquo; failed: Problem with some part of the filterspec or providerspecific buffer in general</p><p>At line:1 char:1</p><ul><li><p>Test-Connection -ComputerName <a href=http://www.google.ie/>www.google.ie</a>  -TimeToLive 3</p></li><li><pre><code>
</code></pre></li></ul><p>    + CategoryInfo          : ResourceUnavailable: (<a href=http://www.google.ie>www.google.ie</a>:String) [Test-Connection], PingException</p><p>    + FullyQualifiedErrorId : TestConnectionException,Microsoft.PowerShell.Commands.TestConnectionCommand</p><p>So I fired fired up Reflector to see what Test-Connection actually does, and it is using WMI and the  Win32_PingStatus class, I have not been able to reproduce the error calling the class directly, so I was wondering where the problem could be.</p><p>So I did a  trace command to see if that would give me anything, one thing I noticed in the return value there was a value called 11013, shortly thereafter this was written in the trace.</p><p><em>MemberResolution Information: 0 :     &ldquo;writeErrorStream&rdquo; NOT present in type table.</em></p><p><em>MemberResolution Information: 0 :     Adapted member: not found.</em></p><p>This made me think that there might be an error in converting the Errorcode from its numerical value into text</p><p>So I  looked up the errorcode from ICMP_ECHO_REPLY32 structure, which has an error code called 11013 which is:</p><p><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb540657(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/bb540657(v=vs.85).aspx</a></p><p>The time to live (TTL) expired in transit.</p><p>Which seems fair because TTL is relatively low, then I looked a bit deeper to try and find what 11013 also could mean</p><p>In  Winsock Error Codes I found:</p><p><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb540657(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/bb540657(v=vs.85).aspx</a></p><p>Then I did some additional testing.</p><p><a href=http://www.xipher.dk/WordPress/wp-content/uploads/PingPowerShell.png><img src=/assets/images/PingPowerShell_thumb.png alt=PingPowerShell title=PingPowerShell></a><br>If you do a Trace-Command on the example with TimeToLive = 11 which gives the error: Error due to lack of ressources, you will see that the error code is 11010 which corresponds to:</p><p>If you look at the WMI Win32_PingStatus error codes 11010 corresponds to:</p><p>The request timed out.</p><p>Which you can confirm using ping from the command prompt:</p><p><a href=http://www.xipher.dk/WordPress/wp-content/uploads/PingDOS.png><img src=/assets/images/PingDOS_thumb.png alt=PingDOS title=PingDOS></a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2013-04-15-sending-out-password-expiration-mails-to-users-in-active-directory/><span class=button__icon>←</span>
<span class=button__text>Sending out Password Expiration mails to users in Active Directory</span></a></span>
<span class="button next"><a href=/posts/2012-03-14-the-mystery-of-why-cisco-anyconnect-stopped-working/><span class=button__text>The mystery of why Cisco AnyConnect stopped working</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>