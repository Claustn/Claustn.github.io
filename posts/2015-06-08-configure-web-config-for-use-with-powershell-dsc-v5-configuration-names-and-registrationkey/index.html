<!doctype html><html lang=en><head><title>Configure Web.Config for use with PowerShell DSC v5 Configuration Names and RegistrationKey :: XenoBlog — Random rants</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="One of the new features of PowerShell v5 DSC, is that you now can use ConfigurationNames in &amp;ldquo;clear-text&amp;rdquo; not GUID, meaning that you can now have human readable names for your configurations. Since they are easier to guess, then there is an added layer of security, now the Pull clients have to register themselves with the Pull server, with a preshared key. When this happens the client LCM will generate a unique AgentID that is used to discern the different clients."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2015-06-08-configure-web-config-for-use-with-powershell-dsc-v5-configuration-names-and-registrationkey/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Configure Web.Config for use with PowerShell DSC v5 Configuration Names and RegistrationKey :: XenoBlog"><meta property="og:description" content="One of the new features of PowerShell v5 DSC, is that you now can use ConfigurationNames in &amp;ldquo;clear-text&amp;rdquo; not GUID, meaning that you can now have human readable names for your configurations. Since they are easier to guess, then there is an added layer of security, now the Pull clients have to register themselves with the Pull server, with a preshared key. When this happens the client LCM will generate a unique AgentID that is used to discern the different clients."><meta property="og:url" content="/posts/2015-06-08-configure-web-config-for-use-with-powershell-dsc-v5-configuration-names-and-registrationkey/"><meta property="og:site_name" content="Configure Web.Config for use with PowerShell DSC v5 Configuration Names and RegistrationKey"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Everyday"><meta property="article:published_time" content="2015-06-08 00:17:18 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>XenoBlog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=https://github.com/claustn>github</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/2015-06-08-configure-web-config-for-use-with-powershell-dsc-v5-configuration-names-and-registrationkey/>Configure Web.Config for use with PowerShell DSC v5 Configuration Names and RegistrationKey</a></h1><div class=post-meta><span class=post-date>2015-06-08</span></div><div class=post-content><div><p>One of the new features of PowerShell v5 DSC, is that you now can use ConfigurationNames in &ldquo;clear-text&rdquo; not GUID, meaning that you can now have human readable names for your configurations. Since they are easier to guess, then there is an added layer of security, now the Pull clients have to register themselves with the Pull server, with a preshared key. When this happens the client LCM will generate a unique AgentID that is used to discern the different clients.</p><p>In order to add the RegistrationKey settings you need to add a line to the web.config file of the DSC Pull server, that entry points to a location in the file system where it can find a file called RegistrationKeys.txt. (You can read more about it here: <a href=http://blogs.msdn.com/b/powershell/archive/2015/05/29/how-to-register-a-node-with-a-dsc-pull-server.aspx>Link</a></p><p>Instead of manually editing the web.config file, I wrote a little script to add the configuration, to help automate the building of pull servers for my demo lab</p><pre><code>$FilePath = 'C:\inetpub\wwwroot\PSDSCPullServer\web.config' [XML]$WebConfig = Get-Content $FilePath $WebConfig.configuration.appSettings.ChildNodes notepad.exe 'C:\inetpub\wwwroot\PSDSCPullServer\web.config' $RegistrationKeyPath = $WebConfig.SelectSingleNode(&quot;//configuration/appSettings/add[@key='RegistrationKeyPath']&quot;) If ($RegistrationKeyPath ) { Write-Warning -Message &quot;RegistrationKeyPath allready exists. With the value $($RegistrationKeyPath.Value), exiting&quot; } Else { $RegistrationKeyPath = $WebConfig.CreateNode('element','add','') $RegistrationKeyPath.SetAttribute('key', 'RegistrationKeyPath') $RegistrationKeyPath.SetAttribute('value', 'C:\Program Files\WindowsPowerShell\DscService' ) $appSettingsNode = $WebConfig.SelectSingleNode('//configuration/appSettings').AppendChild($RegistrationKeyPath) $WebConfig.Save($FilePath) notepad.exe 'C:\inetpub\wwwroot\PSDSCPullServer\web.config' } Set-Content -Path 'C:\Program Files\WindowsPowerShell\DscService\RegistrationKeys.txt' -Value 'MySecureKey'
</code></pre><p>This assumes you have installed to the Pull server to the &ldquo;default&rdquo; location.</p><p>Another annoyance that I have come a across is that I usually have a Danish keyboard layout, and when I use the xPSDesiredStateConfiguration Module, and try to setup a pull server it will complain that I cannot find a file in C:\Windows\System32\WindowsPowerShell\v1.0\Modules\PSDesiredStateConfiguration\PullServer\en. In order to fix this, you can create two localized folders containing the same files as in the en and en-US folders.. I wrote a little script to do this, based on the locale of the machine.</p><pre><code>$CultureShort = (Get-Culture).Parent.Name $CultureLong = (Get-Culture).IetfLanguageTag $CultureShort = New-Item -ItemType Directory -Path &quot;C:\Windows\System32\WindowsPowerShell\v1.0\Modules\PSDesiredStateConfiguration\PullServer\$CultureShort&quot; -Force $CultureLong = New-Item -ItemType Directory -Path &quot;C:\Windows\System32\WindowsPowerShell\v1.0\Modules\PSDesiredStateConfiguration\PullServer\$CultureLong&quot; -Force Copy-Item C:\Windows\System32\WindowsPowerShell\v1.0\Modules\PSDesiredStateConfiguration\PullServer\en\Microsoft.Powershell.DesiredStateConfiguration.Service.resources.dll -Destination $CultureShort Copy-Item C:\Windows\System32\WindowsPowerShell\v1.0\Modules\PSDesiredStateConfiguration\PullServer\en-US\* -Destination $CultureLong
</code></pre><p>Since both scripts are altering files in protected areas of the file system both has to be run as Administrator</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2016-01-05-run-azure-automation-hybrid-worker-using-runas/><span class=button__icon>←</span>
<span class=button__text>Run Azure Automation Hybrid Worker using "RunAs"</span></a></span>
<span class="button next"><a href=/posts/2015-05-06-new-in-wmf-5-april-release/><span class=button__text>New in WMF 5 April release</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>